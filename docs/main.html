<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>tinytest</title>
  </head>

  <body>
    <script src="wasm_exec.js"></script>
    <script>
      const go = new Go()
      let mod, inst
      WebAssembly.instantiateStreaming(fetch('tinytest.wasm'), go.importObject)
        .then((result) => {
          mod = result.module
          inst = result.instance
          document.getElementById('runButton').disabled = false
        })
        .catch((err) => {
          console.error(err)
        })

      async function run() {
        console.log('run: await go.run')
        await go.run(inst)
        console.log('run: done go.run')
        console.log('run: await instantiate')
        inst = await WebAssembly.instantiate(mod, go.importObject) // reset instance
        console.log('run: done instantiate')
      }
    </script>

    <button onClick="run();" id="runButton" disabled>Run</button>
    <p>Output in dev console</p>
  </body>
</html>
